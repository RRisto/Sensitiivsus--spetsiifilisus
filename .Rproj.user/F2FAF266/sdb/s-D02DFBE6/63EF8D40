{
    "contents" : "#eeldusandmed\n#esimene jaotus\nmean1=0\nsd1=1\nnr1=10000\n#teine jaotus\nmean2=2\nsd2=1\nnr2=10000\n#esimene grupp ehk terved\nvalues=rnorm(n=nr1, mean=mean1, sd=sd1)\nvalues=data.frame(values)\n#teine grupp ehk haiged\nvalues2=rnorm(n=nr2, mean=mean2, sd=sd2)\nvalues2=data.frame(values2)\n\n#paneme mõlemad joonisele\nlibrary(ggplot2)\nggplot(values, aes(x=values))+\n    geom_density(colour=\"green\", fill=\"green\", alpha=0.1)+\n    geom_density(data=values2, aes(x=values2), \n                 colour=\"blue\", fill=\"blue\", alpha=0.1)\n\n#paneme mõlemad joonisele ning märgime öra osa, mis on valepositiivsed\nlibrary(dplyr)\nlibrary(reshape2)\nlibrary(data.table)\ndata=cbind(values, values2)  %>% \n    melt  %>% \n    data.table\n\ngg <- data[,list(x=density(value)$x, y=density(value)$y),by=\"variable\"]\n\n#leiame 95% kvintiili esimesest jaotusest\nqnorm(0.95, mean=mean1)#teoreetiline piir\npiir=quantile(values$values, c(0.95)) #päris lähedal\n\n#minu variant, kust saab ära märkida valepositiivsed ja valenegatiivsed\nggplot(data, aes(x=value))+\n    geom_density(aes(group=variable, fill=variable),colour=0, alpha=0.3)+\n    geom_ribbon(data=subset(gg,variable==\"values2\" & x<=piir),\n                aes(x=x,ymax=y),ymin=0,fill=\"red\", alpha=0.2)+\n    geom_ribbon(data=subset(gg,variable==\"values\" & x>=piir),\n                aes(x=x,ymax=y),ymin=0,fill=\"yellow\", alpha=0.2)+\n    geom_vline(xintercept=piir, colour=\"blue\", size=1)\n\nggplot(data, aes(x=value))+\n    geom_density(aes(group=variable), alpha=0.3)+\n    geom_ribbon(data=subset(gg,variable==\"values2\" & x<=piir),\n                aes(x=x,ymax=y),ymin=0,fill=\"red\", alpha=0.2)+\n    geom_ribbon(data=subset(gg,variable==\"values\" & x>=piir),\n                aes(x=x,ymax=y),ymin=0,fill=\"yellow\", alpha=0.2)+\n    geom_vline(xintercept=piir, colour=\"blue\", size=1)\n\n#leiame, mitu % on see teisest jaotusest (values2)\npnorm(piir, mean=mean2, sd=sd2) #teoreetiline\nnrow(subset(values2, values2>piir))/nrow(values2)#päris lähedal\n#õiged positiivsed (keso n haiged ja test seda ka näitab)\ntruepos=nrow(subset(values2, values2>piir))\n#valepositiivsed, need, kes on terved, kuid test näitab haigena\nfalsepos=nrow(subset(values, values>piir))\n#õiged negatiivsed (kes on terved ja ka test nii näitab)\ntrueneg=nrow(subset(values, values<=piir))\n#valengeatiivsed (need, kes on haiged, kuid test näitab tervena)\nfalseneg=nrow(subset(values2, values2<=piir))\n#sensitiivsus\ntruepos/(falseneg+truepos)\n#spetsiifilsus\ntrueneg/(trueneg+falsepos)\n#positive predictive value\ntruepos/(truepos+falsepos)\n#negative predicitve value\ntrueneg/(trueneg+falseneg)\n\n#teeme asjast funktsiooni, esimene funktsioon graafiku tegemiseks\nandmetabel =function(mean1=4, mean2=6, sd1=1, sd2=1, nr1=10000, nr2=10000) {\n    library(dplyr)\n    #esimene grupp ehk terved\n    terved=rnorm(n=nr1, mean=mean1, sd=sd1) %>% \n        data.frame %>%\n        mutate(name=\"terved\")\n        \n    #teine grupp ehk haiged\n    haiged=rnorm(n=nr2, mean=mean2, sd=sd2) %>% \n        data.frame %>% \n        mutate(name=\"haiged\")\n    #paneme ühte tabelisse kokku\n    library(data.table)\n    data=rbind(terved, haiged)%>%\n        data.table\n    \n    names(data)[1]=c(\"value\")\n    data\n}\n     \n#teine funktsioon valenegatiivsete ja -positiivsete visualiseerimiseks\ngraafik=function(data=data, qt=0.95) {\n    \n    gg <- data[,list(x=density(value)$x, y=density(value)$y),by=\"name\"]\n    #piir, kus kohast tervete seas jääb qt% vaatlustest vasakule\n    #ehk test nätab, et on terved\n    sub=subset(data, name==\"terved\", select= c(value))\n    piir=quantile(sub$value, c(qt)) \n    library(ggplot2)\n    ggplot(data, aes(x=value))+\n        geom_density(aes(group=name), alpha=0.4)+\n        geom_ribbon(data=subset(gg,name==\"haiged\" & x<=piir),\n                    aes(x=x,ymax=y, fill=\"valenegatiivsed\"),ymin=0, alpha=0.4)+\n        geom_ribbon(data=subset(gg,name==\"terved\" & x>=piir),\n                    aes(x=x,ymax=y, fill=\"valepositiivsed\"),ymin=0, alpha=0.4)+\n        geom_vline(xintercept=piir, colour=\"blue\", size=1)+\n        scale_fill_discrete(name=\"\")\n}\n\n#kolmas funktsioon spetsiifiluse, tundlikkuse ja määrade välja arvutamiseks\ntabel=function(data=data, qt=0.95) {\n    sub2=subset(data, name==\"terved\", select= c(value))\n    piir=quantile(sub2$value, c(qt)) \n    \n    #õiged positiivsed (kes on haiged ja test seda ka näitab)\n    truepos=nrow(subset(data, name==\"haiged\" & value>piir))\n    #valepositiivsed, need, kes on terved, kuid test näitab haigena\n    falsepos=nrow(subset(data, name==\"terved\" & value>piir))\n    #õiged negatiivsed (kes on terved ja ka test nii näitab)\n    trueneg=nrow(subset(data, name==\"terved\" & value<=piir))\n    #valengeatiivsed (need, kes on haiged, kuid test näitab tervena)\n    falseneg=nrow(subset(data, name==\"haiged\" & value<=piir))\n    näitaja=c(\"sensitiivsus (testi võimsus)\", \"spetsiifilisus\", \n              \"valepositiivsete määr (I tüüpi viga)\", \n              \"valenegatiivsete määr (II tüüpi viga)\",\n              \"positive predictive value\", \n            \"negative predictive value\")\n    väärtus=c(round(truepos/(falseneg+truepos),3),\n                round(trueneg/(trueneg+falsepos),3),\n                1-round(trueneg/(trueneg+falsepos),3),\n                1-round(truepos/(falseneg+truepos),3),\n                round(truepos/(truepos+falsepos),3),\n                round(trueneg/(trueneg+falseneg),3))\n    data.frame(näitaja, väärtus)\n}\n\n\n#funktsioon mis teeb spec, sens, pos-pred value, neg-pred value tabeli\n\npopulation=20000\nspec=0.95\nsens=0.638\nratio=0.5 #haigete osakaal\n\nhaige=c(round(population*ratio*sens, 0), round(population*ratio*(1-sens), 0))\nterve=c(round(population*(1-ratio)*(1-spec), 0), round(population*(1-ratio)*spec, 0))\ntulem=c(\"test positiivne\", \"test negatiivne\")\ntest_summary=data.frame(tulem, haige, terve)\npospred=haige[1]/(haige[1]+terve[1])\nnegpred=terve[2]/(haige[2]+terve[2])\n\n\n#teeme funktsiooniks\nneg_pos_predictive=function(ratio, sensitivity, specificity) {\n    population=20000\n    haige=c(round(population*ratio*sensitivity, 0), round(population*ratio*(1-sensitivity), 0))\n    terve=c(round(population*(1-ratio)*(1-specificity), 0), round(population*(1-ratio)*specificity, 0))\n    tulem=c(\"test positiivne\", \"test negatiivne\")\n    test_summary=data.frame(tulem, haige, terve)\n    pospred=haige[1]/(haige[1]+terve[1])\n    negpred=terve[2]/(haige[2]+terve[2])\n    return(data.frame(pospred, negpred))\n}\n\nratiod=c(0.9, 0.7, 0.5, 0.3, 0.1)\nvastus= data.frame(positive_pred=numeric(),\n                   negative_pred=numeric())\n\nfor (i in 1:length(ratiod)) {\n    vastus[i,]=neg_pos_predictive(ratio=ratiod[i], sensitivity = 0.8, specificity=0.95)\n}\n\nvastus$sensitivity=0.8\nvastus$specificity=0.95\nvastus$ratio=ratiod\n#plotime\nlibrary(ggplot2)\n\nggplot(vastus, aes(x=ratio, y=positive_pred))+\n    geom_line(colour=\"blue\")+\n    geom_line(aes(y=negative_pred), colour=\"red\")+\n    ylab(\"%\")\n\n#väikese levikuga korral\nratiod2=c(0.1, 0.07, 0.05, 0.03, 0.01)\nvastus2= data.frame(positive_pred=numeric(),\n                   negative_pred=numeric())\n\nfor (i in 1:length(ratiod2)) {\n    vastus2[i,]=neg_pos_predictive(ratio=ratiod2[i], sensitivity = 0.8, specificity=0.95)\n}\n\nvastus2$sensitivity=0.8\nvastus2$specificity=0.95\nvastus2$ratio=ratiod2\n\nggplot(vastus2, aes(x=ratio, y=positive_pred))+\n    geom_line(colour=\"blue\")+\n    geom_line(aes(y=negative_pred), colour=\"red\")+\n    ylab(\"%\")\n\n#paneme kokku väikese ja suure leviku \nratiod2=c(0.999,0.99,0.98,0.97,0.96,0.95,0.94,0.93,0.92,0.91,0.9,0.8, 0.7, \n          0.6,0.5, 0.4,0.3,0.2,0.1, 0.07, 0.05, 0.03, 0.01, 0.001)\nvastus2= data.frame(positive_pred=numeric(),\n                    negative_pred=numeric())\n\nfor (i in 1:length(ratiod2)) {\n    vastus2[i,]=neg_pos_predictive(ratio=ratiod2[i], sensitivity = 0.8, specificity=0.95)\n}\n\nvastus2$ratio=ratiod2\n#reshabime\nlibrary(reshape2)\nvastus2=melt(vastus2, id=c(\"ratio\"))\n#plotime\nlibrary(scales) \nggplot(vastus2, aes(x=ratio, y=value))+\n    geom_line(aes(colour=variable), size=1)+\n    xlab(\"haigete osakaal populatsioonist\")+\n    scale_y_continuous(labels=percent)+\n    scale_x_continuous(labels=percent)+\n    theme_minimal()\n\n",
    "created" : 1440686802351.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "895932197",
    "id" : "63EF8D40",
    "lastKnownWriteTime" : 1440525463,
    "path" : "C:/Users/Risto/OneDrive/Dokumendid/R/Sensitiivsus--spetsiifilisus/power, sensitivity, specificity.R",
    "project_path" : "power, sensitivity, specificity.R",
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "type" : "r_source"
}